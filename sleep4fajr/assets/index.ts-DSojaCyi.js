var u={};console.log("background script loaded!");const m=u.APi_KEY;function d(t){const o=new Date,[s,e]=t.split(" ");let[r,n]=s.split(":");e==="pm"&&r!=="12"?r=String(Number(r)+12):e==="am"&&r==="12"&&(r="00");const i=new Date(o);i.setHours(Number(r),Number(n),0,0),o>i&&i.setDate(i.getDate()+1);const a=c=>{const l=c*90+15;return new Date(i.getTime()-l*6e4).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})};return{oneCycle:a(1),twoCycles:a(2),threeCycles:a(3),fourCycles:a(4),fiveCycles:a(5),sixCycles:a(6)}}async function f(t,o){const s=`https://muslimsalat.com/${t}.json?key=${m}`;try{const e=await fetch(s);if(!e.ok)throw new Error(`API request failed with status ${e.status}`);const r=await e.json(),n={status_valid:r.status_valid,status_description:r.status_description,items:r.items,country:r.country,country_code:r.country_code};return await chrome.storage.local.set({prayerTimes:n}),n}catch(e){throw console.error("Error fetching data:",e),e}}const y=async()=>{try{const o=(await chrome.storage.sync.get("location")).location;if(!o)throw new Error("No location found in storage.");return await f(o)}catch(t){throw console.error("Failed to refetch data:",t),t}};chrome.runtime.onMessage.addListener((t,o,s)=>{if(t.type==="REFETCH_DATA")return y().then(e=>{s({success:!0,data:e})}).catch(e=>{s({success:!1,error:e.message})}),!0});chrome.runtime.onMessage.addListener((t,o,s)=>{if(t.type==="getPrayerTimes")return chrome.storage.local.get("prayerTimes",e=>{s(e.prayerTimes)}),!0});chrome.runtime.onInstalled.addListener(()=>{console.log("Extension installed, initializing notifications...")});chrome.runtime.onMessage.addListener((t,o,s)=>{if(t.type==="GET_SLEEP_TIMES"){const e=t.fajrTime||"6:30 am",r=d(e);s(r)}return!0});
